#!/usr/bin/python

import os
import argparse
from launcher.utilities.printer import Printer
from launcher.finder import Finder
from launcher.runner import Runner

## Starting raiden launcher
## Defining application arguments
parser = argparse.ArgumentParser()
parser.add_argument("action", help="Define launcher action, can be start, stop, restart, delete")
parser.add_argument("--platform", help="Define the platform folder path")
parser.add_argument("--applications", help="Define the application folder path")
arguments = parser.parse_args()

## setting the raiden root path
raiden_path = os.path.dirname(os.path.realpath(__file__))

finder = Finder()
platform = None
applications = None

## Setting global printer
printer = Printer()
printer.level = printer.DEBUG

## Checking if user want to override some paths
if arguments.platform:
	platform = finder.search(arguments.platform)
else:
	platform = finder.search(raiden_path + "/platform")

## Loading applications is not mandatory
if arguments.applications:
	applications = finder.search()

## Launch docker collections
## - First the platform
## - And then applications

if not platform:
	printer.info("No images found for platform")
	exit(1)

runner = Runner()
runner.run(platform, arguments.action)

if not applications == None:
	runner.run(applications, arguments.action)

printer.info("Done !")